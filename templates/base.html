<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistem Prediksi Kredit{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        primaryDark: '#1e40af',
                        accent: '#3b82f6',
                        background: '#f8fafc',
                        surface: '#ffffff',
                        error: '#dc2626',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
            }

            to {
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .material-shadow {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .material-shadow-lg {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15), 0 16px 32px rgba(0, 0, 0, 0.15);
        }

        .nav-item {
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            background-color: rgba(37, 99, 235, 0.08);
            transform: translateX(8px);
        }

        .nav-item.active {
            background: rgba(37, 99, 235, 0.1);
            border-right: 4px solid #2563eb;
            backdrop-filter: blur(10px);
        }

        .floating-action-button {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: rgba(37, 99, 235, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3), 0 8px 16px rgba(37, 99, 235, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-action-button:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3), 0 12px 24px rgba(0, 0, 0, 0.2);
        }

        .card-android {
            background: white;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .card-android:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15), 0 16px 32px rgba(0, 0, 0, 0.15);
        }

        /* Sidebar overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }

        .sidebar-overlay.active {
            display: block;
        }

        /* Mobile sidebar */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-background min-h-screen">
    <!-- App Bar -->
    <header class="bg-primary text-white material-shadow-lg fixed w-full top-0 z-30">
        <div class="flex items-center justify-between px-4 py-4">
            <div class="flex items-center space-x-4">
                <button onclick="toggleSidebar()" class="md:hidden focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
                <div class="flex items-center space-x-3">
                    <div class="bg-white p-2 rounded-lg">
                        <i class="fas fa-chart-line text-xl text-primary"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">NPL Predictor</h1>
                        <p class="text-xs text-purple-200">Credit Risk Analysis</p>
                    </div>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button class="relative hover:bg-white/10 p-2 rounded-full transition-colors">
                    <i class="fas fa-bell text-xl"></i>
                    <span
                        class="absolute top-1 right-1 bg-error text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">3</span>
                </button>
                <button class="hover:bg-white/10 p-2 rounded-full transition-colors">
                    <i class="fas fa-user-circle text-2xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar Overlay (Mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Main Container -->
    <div class="flex pt-16">
        <!-- Sidebar Navigation -->
        <aside
            class="sidebar fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-white material-shadow-lg overflow-y-auto z-50 md:translate-x-0"
            id="sidebar">
            <div class="p-4">
                <!-- User Profile -->
                <div class="relative rounded-lg p-4 mb-6 text-white overflow-hidden">
                    <div class="absolute inset-0 bg-blue-600 opacity-90"></div>
                    <div class="absolute inset-0 backdrop-blur-xl"></div>
                    <div class="relative flex items-center space-x-3">
                        <div class="bg-white/20 backdrop-blur-sm p-3 rounded-full border border-white/30">
                            <i class="fas fa-user text-2xl"></i>
                        </div>
                        <div>
                            <p class="font-semibold">Admin User</p>
                            <p class="text-xs text-blue-100">Credit Analyst</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation Menu -->
                <nav class="space-y-1">
                    <a href="/"
                        class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 {% if request.endpoint == 'dashboard' %}active{% endif %}">
                        <i class="fas fa-home w-5"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    <a href="/predict"
                        class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 {% if request.endpoint == 'predict_page' %}active{% endif %}">
                        <i class="fas fa-calculator w-5"></i>
                        <span class="font-medium">Prediksi Kredit</span>
                    </a>
                    <a href="/history"
                        class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 {% if request.endpoint == 'history' %}active{% endif %}">
                        <i class="fas fa-history w-5"></i>
                        <span class="font-medium">Riwayat</span>
                    </a>
                    <a href="/analytics"
                        class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 {% if request.endpoint == 'analytics' %}active{% endif %}">
                        <i class="fas fa-chart-bar w-5"></i>
                        <span class="font-medium">Analitik</span>
                    </a>
                    <a href="/about"
                        class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 {% if request.endpoint == 'about' %}active{% endif %}">
                        <i class="fas fa-info-circle w-5"></i>
                        <span class="font-medium">Tentang Model</span>
                    </a>

                    <div class="border-t my-4"></div>

                    <a href="/settings" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700">
                        <i class="fas fa-cog w-5"></i>
                        <span class="font-medium">Pengaturan</span>
                    </a>
                    <a href="/help" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700">
                        <i class="fas fa-question-circle w-5"></i>
                        <span class="font-medium">Bantuan</span>
                    </a>
                </nav>

                <!-- Model Info Card -->
                <div class="mt-6 relative rounded-lg p-4 overflow-hidden">
                    <div class="absolute inset-0 bg-blue-50/80 backdrop-blur-xl"></div>
                    <div class="absolute inset-0 border border-blue-200/50 rounded-lg"></div>
                    <div class="relative">
                        <div class="flex items-center space-x-2 mb-2">
                            <i class="fas fa-robot text-primary"></i>
                            <p class="font-semibold text-sm text-gray-800">Model Active</p>
                        </div>
                        <p class="text-xs text-gray-600">{{ metadata.model_name }}</p>
                        <div class="mt-2 flex items-center space-x-1">
                            <div class="flex-1 bg-blue-200/50 backdrop-blur-sm rounded-full h-2">
                                <div class="bg-primary rounded-full h-2"
                                    style="width: {{ (metadata.accuracy * 100) }}%">
                                </div>
                            </div>
                            <span class="text-xs font-semibold text-primary">{{ (metadata.accuracy * 100)|round(1)
                                }}%</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 md:ml-64 p-4 md:p-6 min-h-screen">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Floating Action Button -->
    <a href="/predict" class="floating-action-button">
        <i class="fas fa-plus text-white text-xl"></i>
    </a>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="fixed top-20 right-4 z-50 space-y-2"></div>

    <script>
        // Toggle sidebar on mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        // Close sidebar when clicking outside on mobile
        window.addEventListener('resize', function () {
            if (window.innerWidth >= 768) {
                document.getElementById('sidebar').classList.remove('mobile-open');
                document.getElementById('sidebarOverlay').classList.remove('active');
            }
        });

        // Toast notification function
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-orange-500',
                'info': 'bg-blue-500'
            }[type] || 'bg-blue-500';

            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg material-shadow-lg flex items-center space-x-3 fade-in`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;

            document.getElementById('toastContainer').appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Store prediction in localStorage
        function savePredictionToHistory(data) {
            let history = JSON.parse(localStorage.getItem('predictionHistory') || '[]');
            history.unshift({
                ...data,
                timestamp: new Date().toISOString(),
                id: Date.now()
            });
            // Keep only last 50 predictions
            if (history.length > 50) history = history.slice(0, 50);
            localStorage.setItem('predictionHistory', JSON.stringify(history));
        }

        // Get prediction history from localStorage
        function getPredictionHistory() {
            return JSON.parse(localStorage.getItem('predictionHistory') || '[]');
        }

        // Format currency
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Format date
        function formatDate(dateString) {
            return new Date(dateString).toLocaleString('id-ID', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>

    {% block extra_js %}{% endblock %}
</body>

</html>